# Docker ã€€ã‚³ãƒ³ãƒ†ãƒŠé–‹ç™ºãƒ»ç’°å¢ƒæ§‹ç¯‰ã®åŸºæœ¬

# å¸‚å·è±Šè‘—ã€ã‚¤ãƒ³ãƒ—ãƒ¬ã‚¹ç¤¾ã€ISBN978-4-295-01173-6ã€C3055ã€\3000E

# chap02

## docker hub

- docker hub ã«ãƒ¬ãƒã‚¸ãƒˆãƒªä½œæˆ

# Chap03

## add ã¨ copy

add ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã€tarã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¸Šã®ãƒªã‚½ãƒ¼ã‚¹
copy ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ã¿

## CMD ã¨ ENTORYPOINT

docker container RUN <ã‚³ãƒ³ãƒ†ãƒŠå> <å®Ÿè¡Œãƒ—ãƒ­ã‚»ã‚¹> <å¼•æ•°>
ã®å®Ÿè¡Œæ™‚ã€CMD ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®ã‚ˆã†ã«ãµã‚‹ã¾ã„ã€
ENTORYPOINT ã¯åŸå‰‡ä¸Šæ›¸ãã§ããªã„ã€‚ãŸã ã—ã€--entrypoint ã‚’ä»˜ã‘ã‚‹ã¨ä¸Šæ›¸ãã§ãã‚‹ã€‚

## 3-1-1-01 ã€€ image ã® build

image ã® Build

- docker image build -t [ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸å] [Dockerfile ã®ãƒ‘ã‚¹]

ä¾‹ï¼š

```
export DOCKERHUB_REPO_NAME="zeta80a"
docker image build -t ${DOCKERHUB_REPO_NAME}/sample-nginx .
```

ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®ç¢ºèª

- docker container ls [ã‚ªãƒ—ã‚·ãƒ§ãƒ³]

ä¾‹ï¼š

```
ocker container ls
```

build ã®å±¥æ­´ã‚’ã¿ã‚‹

- docker image history [ã‚ªãƒ—ã‚·ãƒ§ãƒ³] ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸å

ä¾‹ï¼š

```
docker image history ${DOCKERHUB_REPO_NAME}/sample-nginx
```

## 3-1-1-03 ã€€ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ & RUN

## æ¦‚è¦

ãƒ»ãƒãƒ«ãƒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰ã¯å„ã‚¹ãƒ†ãƒ¼ã‚¸æ¯ã«ã®æˆæœç‰©ã‚’æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã®å…¥åŠ›ã¨ã—ã¦ã‚Šã‚ˆã†ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
ä¾‹ãˆã°ã€FROM golang:1.16.4-alpine3.13 AS builder
ã® AS å¥ã§ builder ã‚’æŒ‡å®šã€‚

ãƒ»æ¬¡ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã§--from=builder ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§å‰ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã®æˆæœç‰©ã‚’æŒ‡å®šã§ãã‚‹ã€‚
ä¾‹ï¼š

```
COPY --from=builder /msb /usr/local/bin/msb
```

ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¸ã®åŒºåˆ‡ã‚Šã¯ FROM å¥

## Run

ãƒ»image ã® Buildã€‚Dockerfile ã®ãƒ•ã‚¡ã‚¤ãƒ«åãŒéãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å ´åˆã€‚

- docker image build -t [ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸å] -f [Dockerfile ã®ãƒ•ã‚¡ã‚¤ãƒ«å] [Dockerfile ã®ãƒ‘ã‚¹]

ä¾‹ï¼š

```
docker image build -t msb -f Dockerfile-msb .
```

ãƒ»image ã® Run

- docker containter run [ã‚ªãƒ—ã‚·ãƒ§ãƒ³] ã‚¤ãƒ¡ãƒ¼ã‚¸å [ã‚³ãƒãƒ³ãƒ‰] [ARG...]

ä¾‹ï¼š

```
docker containter run -it --rm msb
```

### ã‚³ãƒ³ãƒ†ãƒŠã®å†…å®¹ç¢ºèªã‚³ãƒãƒ³ãƒ‰

ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’æŒ‡å®šã—ã¦ã‚³ãƒ³ãƒ†ãƒŠã‚’å¯¾è©±çš„ã«èµ·å‹•å¾Œã€entrypoint ã‚’ç„¡è¦–ã—ã¦ ls ã‚’å®Ÿè¡Œã—ã€ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤ã™ã‚‹ã€‚

- docker container run -it --rm [--entrypoint ã‚³ãƒãƒ³ãƒ‰å] ã‚¤ãƒ¡ãƒ¼ã‚¸å [ã‚³ãƒãƒ³ãƒ‰ã«æ¸¡ã™ã‚ªãƒ—ã‚·ãƒ§ãƒ³]

ä¾‹ï¼š

```
docker container run -it --rm --entrypoint ls msb -la /usr/local/bin/
docker container run -it --rm --entrypoint vi msb /etc/hosts
```

## 3-2-2 ã‚³ãƒ³ãƒ†ãƒŠã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### trivy

ãƒ»trivy ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ä¾‹ï¼š

```
curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/master/contrib/install.sh | sudo sh -s -- -b /usr/local/bin

```

ãƒ»trivy ã«ã‚ˆã‚‹ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯

- trivy image [ã‚¤ãƒ¡ãƒ¼ã‚¸å]

ä¾‹ï¼š

```
trivy image ${DOCKERHUB_REPO_NAME}/sample-nginx
```

## 3-2-4 ã‚¤ãƒ¡ãƒ¼ã‚¸ã® push/pull & tag ä»˜ã‘

### docker hub ã¸ã®ãƒ­ã‚°ã‚¤ãƒ³

- docker login [ã‚ªãƒ—ã‚·ãƒ§ãƒ³] [ã‚µãƒ¼ãƒ]

ä¾‹ï¼š

```
docker login
```

(ä»¥ä¸‹ã®å‡ºåŠ›ã€‚XXXX-XXXX ã‚’ https://login.docker.com/activateã‚’é–‹ã„ã¦å…¥åŠ›ã€‚githubã¨åŒã˜å½¢å¼)

```
USING WEB-BASED LOGIN

i Info â†’ To sign in with credentials on the command line, use 'docker login -u <username>'

Your one-time device confirmation code is: XXXX-XXXX
Press ENTER to open your browser or submit your device code here: https://login.docker.com/activate

Waiting for authentication in the browserâ€¦

WARNING! Your credentials are stored unencrypted in '/home/username/.docker/config.json'.
Configure a credential helper to remove this warning. See
https://docs.docker.com/go/credential-store/ã€€ï¼‰
```

### push & pull

ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ DockerHub ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥

- docker image push [ã‚ªãƒ—ã‚·ãƒ§ãƒ³] ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸å [:ã‚¿ã‚°]

ä¾‹ï¼š

```
docker image push ${DOCKERHUB_REPO_NAME}/sample-nginx
```

ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ DockerHub ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã‹ã‚‰ãƒ—ãƒ«

- docker image pull [ã‚ªãƒ—ã‚·ãƒ§ãƒ³] ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸å [:ã‚¿ã‚°]

ä¾‹ï¼š

```
docker image pull ${DOCKERHUB_REPO_NAME}/sample-nginx
```

### ã‚¿ã‚°ä»˜ã‘

- docker image tag ã‚½ãƒ¼ã‚¹ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸å[:ã‚¿ã‚°]ã€€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚³ãƒ³ãƒ†ãƒŠå[:ã‚¿ã‚°]

ä¾‹ï¼š

```
docker image tag 8a7fab2601fc ${DOCKERHUB_REPO_NAME}/sample-nginx:1.0
```

## 3-3-2 ã€€ã‚³ãƒ³ãƒ†ãƒŠæ“ä½œ

ãƒ»ã‚³ãƒ³ãƒ†ãƒŠèµ·å‹•
-d:ãƒãƒƒã‚¯ãƒ©ã‚¦ãƒ³ãƒ‰èµ·å‹•
-p:ãƒãƒ¼ãƒˆæŒ‡å®šã€‚æ›¸å¼ã¯"ãƒ›ã‚¹ãƒˆãƒãƒ¼ãƒˆ"ï¼š"ã‚³ãƒ³ãƒ†ãƒŠãƒãƒ¼ãƒˆ"ã€‚

- docker container run --name ã‚³ãƒ³ãƒ†ãƒŠã«ä»˜ä¸ã™ã‚‹åå‰ -d -p ãƒ›ã‚¹ãƒˆãƒãƒ¼ãƒˆ:ã‚³ãƒ³ãƒ†ãƒŠãƒãƒ¼ãƒˆ ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ¬ãƒã‚¸ãƒˆãƒªå

ä¾‹ï¼š

```
docker container run --name sample-nginx -d -p 8080:80 ${DOCKERHUB_REPO_NAME}/sample-nginx
```

ãƒ»ã‚³ãƒ³ãƒ†ãƒŠæ¥ç¶š
-i:æ¨™æº–ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ã„ãŸã¾ã¾
-t:ä»®æƒ³ã‚¿ãƒ¼ãƒŸãƒŠãƒ«å‰²ã‚Šå½“ã¦

- docker container exec -it ã‚³ãƒ³ãƒ†ãƒŠå ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å®Ÿè¡Œã™ã‚‹ã‚³ãƒãƒ³ãƒ‰

ä¾‹ï¼š

```
docker container exec -it sample-nginx /bin/bash
```

ãƒ»ã‚³ãƒ³ãƒ†ãƒŠåœæ­¢

- docker container stop ã‚³ãƒ³ãƒ†ãƒŠå

ä¾‹ï¼š

```
docker container stop sample-nginx
```

ãƒ»ã‚³ãƒ³ãƒ†ãƒŠé–‹å§‹

- docker container start ã‚³ãƒ³ãƒ†ãƒŠå

ä¾‹ï¼š

```
docker container start sample-nginx
```

ãƒ»ã‚³ãƒ³ãƒ†ãƒŠã¸ã®ã‚³ãƒ”ãƒ¼

- docker container cp [ã‚ªãƒ—ã‚·ãƒ§ãƒ³] ãƒ›ã‚¹ãƒˆã®ã‚³ãƒ”ãƒ¼å…ƒãƒ‘ã‚¹ã€€ã‚³ãƒ³ãƒ†ãƒŠå:ã‚³ãƒ³ãƒ†ãƒŠå†…ã®ãƒ‘ã‚¹

ä¾‹ï¼š

```
docker container cp copy.html sample-nginx:/usr/share/nginx/html
```

ãƒ»ã‚³ãƒ³ãƒ†ãƒŠã®ç¨¼åƒçŠ¶æ³ç¢ºèª
ã‚³ãƒ³ãƒ†ãƒŠã®ç¨¼åƒçŠ¶æ³ã‚’ãƒ¬ãƒãƒ¼ãƒˆã€‚linux ã® top ã«åŒã˜ã€‚ctrl+c ã§çµ‚äº†ã€‚

- docker container stats [ã‚ªãƒ—ã‚·ãƒ§ãƒ³] ã‚³ãƒ³ãƒ†ãƒŠå

ä¾‹ï¼š

```
docker container stats sample-nginx
```

ãƒ»ã‚³ãƒ³ãƒ†ãƒŠã®è©³ç´°æƒ…å ±ã‚’èª¿æŸ»
ã‚³ãƒ³ãƒ†ãƒŠã®å†…éƒ¨æƒ…å ±ã‚’ JSON å½¢å¼ã§å‡ºåŠ›

- docker container inspect [ã‚ªãƒ—ã‚·ãƒ§ãƒ³] ã‚³ãƒ³ãƒ†ãƒŠå

ä¾‹ï¼š

```
docker container inspect sample-nginx
```

ãƒ»ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤
ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤ã€‚ãŸã ã—ã€äº‹å‰ã«ã‚³ãƒ³ãƒ†ãƒŠã‚’åœæ­¢ã™ã‚‹ã“ã¨ã€‚

- docker container rm [ã‚ªãƒ—ã‚·ãƒ§ãƒ³]ã€€ã‚³ãƒ³ãƒ†ãƒŠå

ä¾‹ï¼š

```
docker container rm sample-nginx
```

ãƒ»ã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°åé›†
ã‚³ãƒ³ãƒ†ãƒŠãŒå‡ºåŠ›ã™ã‚‹ãƒ­ã‚°ã‚’å–å¾—ã€‚
ã‚ã‚‰ã‹ã˜ã‚,Dockerfile ã§ã‚³ãƒ³ãƒ†ãƒŠã®æ¨™æº–å‡ºåŠ›ã€ãŠã‚ˆã³ã‚¨ãƒ©ãƒ¼å‡ºåŠ›ã‚’ access.log ãªã©ã«ã‚½ãƒ•ãƒˆãƒªãƒ³ã‚¯ã—ã¦ãŠãã€‚
ï¼ˆä¾‹ï¼š# ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã¨ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’æ¨™æº–å‡ºåŠ›ã«å‡ºåŠ›

ä¾‹ï¼šDockerfile ä¸­ã«è¨˜è¿°ã™ã‚‹ã€‚

```
RUN ln -sf /dev/stdout /var/log/nginx/access.log && ln -sf /dev/stderr /var/log/nginx/error.logï¼‰
```

- docker container logs sample-nginx

ä¾‹ï¼š

```
docker container logs sample-nginx
```

## 3-3-3 ã€€æ°¸ç¶šåŒ–ãƒ‡ãƒ¼ã‚¿

æ°¸ç¶šåŒ–ãƒ‡ãƒ¼ã‚¿ã¯ 3 ç¨®é¡
ãƒ»ãƒã‚¤ãƒ³ãƒ‰ãƒã‚¦ãƒ³ãƒˆ(Bind mount)
ãƒ»ãƒœãƒªãƒ¥ãƒ¼ãƒ (Volume)
ãƒ»ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ãƒã‚¦ãƒ³ãƒˆ(tmpfsmount)

### 3-3-4 ã€€ãƒã‚¦ãƒ³ãƒˆ

ã‚ªãƒ—ã‚·ãƒ§ãƒ³
--mount:ãƒ›ã‚¹ãƒˆä¸Šã«ãƒ‘ã‚¹ãŒå­˜åœ¨ã—ãªã„å ´åˆã€ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã€‚
-v:ãƒ›ã‚¹ãƒˆä¸Šã«ãƒ‘ã‚¹ãŒå­˜åœ¨ã—ãªã„å ´åˆã€ä½œæˆã™ã‚‹ã€‚
[--mount ã®ãƒ‘ã‚¿ãƒ¼ãƒ³]

- docker container run --name ã‚³ãƒ³ãƒ†ãƒŠå -d -p ãƒ›ã‚¹ãƒˆãƒãƒ¼ãƒˆ:ã‚³ãƒ³ãƒ†ãƒŠãƒãƒ¼ãƒˆ --mount type=bind,source=ãƒ›ã‚¹ãƒˆå´ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹,target=ã‚³ãƒ³ãƒ†ãƒŠå´ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹ ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸å
  [-v ã®ãƒ‘ã‚¿ãƒ¼ãƒ³]
- docker container run --name ã‚³ãƒ³ãƒ†ãƒŠå -d -p ãƒ›ã‚¹ãƒˆãƒãƒ¼ãƒˆ:ã‚³ãƒ³ãƒ†ãƒŠãƒãƒ¼ãƒˆ -v ãƒ›ã‚¹ãƒˆå´ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹:ã‚³ãƒ³ãƒ†ãƒŠå´ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹ ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸å

ä¾‹[--mount ã®ãƒ‘ã‚¿ãƒ¼ãƒ³]ï¼š

```
docker container bind-nginx -d -p 8080:80 --mount type=bind,source=/home/ginka/projects/LERAN/Docker/dev-env-cons-bas/Chapter03/3-3-4-01/htdocs,target=/usr/share/nginx/html nginx ã€€
```

ä¾‹[-v ã®ãƒ‘ã‚¿ãƒ¼ãƒ³]ï¼š

```
docker container run --name bind-nginx -d -p 8080:80 -v /home/ginka/projects/LERAN/Docker/dev-env-cons-bas/Chapter03
/3-3-4-01/htdocs:/usr/share/nginx/html nginx
```

### 3-3-5 ã€€ Volume

ãƒ»ãƒœãƒªãƒ¥ãƒ¼ãƒ ä½œæˆ

- dcoker volume create [ã‚ªãƒ—ã‚·ãƒ§ãƒ³] ãƒœãƒªãƒ¥ãƒ¼ãƒ å

ä¾‹ï¼š

```
dcoker volume create htdocs
```

ãƒ»ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒã‚¦ãƒ³ãƒˆ

- docker container run --name ä»˜ä¸ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠå -d -p ãƒ›ã‚¹ãƒˆã®ãƒãƒ¼ãƒˆ:ã‚³ãƒ³ãƒ†ãƒŠã®ãƒãƒ¼ãƒˆ -v ãƒœãƒªãƒ¥ãƒ¼ãƒ å:ã‚³ãƒ³ãƒ†ãƒŠãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹ ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸å

ä¾‹ï¼š

```
docker container run --name volume-nginx -d -p 8080:80 -v htdocs:/usr/share/nginx/html nginx
```

ãƒ»ä½œæˆã—ãŸ volume ã«ã‚¢ã‚¯ã‚»ã‚¹
ã€€ä½œæˆã—ãŸ Volume ã¯"/var/lib/docker/volumes/htdocs/\_data"ã«ä½œæˆã•ã‚Œã‚‹ã€‚sudo ã§å„ç¨®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ç¢ºèªã§ãã‚‹ã€‚

ä¾‹ï¼š

```
sudo ls /var/lib/docker/volumes/htdocs/_data
sudo cp -p /home/ginka/projects/LERAN/Docker/dev-env-cons-bas/Chapter03/3-3-4-02/volume.html /var/lib/docker/volumes/htdocs/_data/volume.html
```

### 3-3-6 ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ 

åœæ­¢ã—ã¦ã€èµ·å‹•ã™ã‚‹ã¨ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ä¿å­˜ã—ãŸãƒ‡ãƒ¼ã‚¿ã¯ã™ã¹ã¦æ¶ˆãˆã¦ã„ã‚‹ã€‚

- docker container -itd --name ä»˜ä¸ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠå --mount type=tmpfs,destination=ã‚³ãƒ³ãƒ†ãƒŠå´ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹,tmpfs-size=ãƒã‚¦ãƒ³ãƒˆã‚µã‚¤ã‚º,tmpfs-mode=ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ‰(8 é€²æ•°) ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸å

ä¾‹ï¼š

```
docker container run -itd --name tmpfs-nginx --mount type=tmpfs,destination=/root/tmp,tmpfs-size=10,tmpfs-mode=755 nginx
```

### 3-3-7 ãƒ‡ãƒ¼ã‚¿ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠ

è¤‡æ•°ã®ã‚³ãƒ³ãƒ†ãƒŠã§å…±æœ‰ã§ãã‚‹ãƒœãƒªãƒ¥ãƒ¼ãƒ ã€‚Docker å†…ã® NAS ã®ã‚ˆã†ãªã‚‚ã®ã€‚

```mermaid
graph LR
  subgraph "ãƒ›ã‚¹ãƒˆ"
    host_dir[ğŸ“ãƒ›ã‚¹ãƒˆã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª]
  end
  subgraph "ã‚³ãƒ³ãƒ†ãƒŠç¾¤"
    SHARE_01[ğŸ–¥ï¸ã‚³ãƒ³ãƒ†ãƒŠ1]
    data_volume[ğŸ—„ï¸ãƒ‡ãƒ¼ã‚¿ãƒœãƒªãƒ¥ãƒ¼ãƒ </br>ã‚³ãƒ³ãƒ†ãƒŠ]
    SHARE_02[ğŸ–¥ï¸ã‚³ãƒ³ãƒ†ãƒŠ2]
  end
  SHARE_01-->data_volume
  SHARE_02-->data_volume
  data_volume-->host_dir
```

ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆ
ã€€ã“ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ›ã‚¹ãƒˆã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ã€ãƒ‡ãƒ¼ã‚¿ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠã®ã‚ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒã‚¦ãƒ³ãƒˆã™ã‚‹ã€‚

- docker container run -it -d --name ãƒ‡ãƒ¼ã‚¿ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠå -v ãƒ›ã‚¹ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª:ãƒ‡ãƒ¼ã‚¿ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª ã‚¤ãƒ¡ãƒ¼ã‚¸å

ä¾‹ï¼š

```
docker container run -it -d --name data-volume -v /tmp/data-volume/share:/tmp/data busybox
```

ãƒ»ãƒ‡ãƒ¼ã‚¿ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠã«æ¥ç¶šã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆ

- docker container run -it -d --name ä»˜ä¸ã‚³ãƒ³ãƒ†ãƒŠå --volumes-from ãƒ‡ãƒ¼ã‚¿ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚³ãƒ³ãƒ†ãƒŠå ã‚¤ãƒ¡ãƒ¼ã‚¸å

ä¾‹ï¼š

```
docker container run -it -d --name share01 --volumes-from data-volume ubuntu
```

### 3-3-8 ã‚³ãƒ³ãƒ†ãƒŠã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯

Docker ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã¯ä»¥ä¸‹ã® 3 ç¨®
ãƒ»none :ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ã€‚ãƒ›ã‚¹ãƒˆã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã—ãªã„
ãƒ»host :ä¸€å°ã®ã¿ãƒ›ã‚¹ãƒˆã«æ¥ç¶š
ãƒ»bridge :ãƒ–ãƒªãƒƒã‚¸ã‚’ä½¿ç”¨ã—ã¦ãƒ›ã‚¹ãƒˆã«æ¥ç¶š

bridge ã‚’ä½¿ãˆã°ã€ã‚³ãƒ³ãƒ†ãƒŠã®ãƒãƒ¼ãƒˆç•ªå·ã¯ bridge ãŒç•°ãªã‚Œã°ã€ç«¶åˆã—ãªã„ã€‚
--network ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ bridge åã‚’æŒ‡å®šã™ã‚‹ã€‚æŒ‡å®šã—ãªã„å ´åˆã¯ docker0 ãŒä½¿ç”¨ã•ã‚Œã‚‹ã€‚

#### ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¢ºèª

ãƒ›ã‚¹ãƒˆã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ä½œæˆã•ã‚Œã¦ã„ã‚‹ bridge ã‚’ç¢ºèªã§ãã‚‹ã€‚

ä¾‹ï¼š

```
ip a
```

docker ã§ä½œæˆã•ã‚ŒãŸ network ã®ä¸€è¦§ã‚’è¡¨ç¤º

```
docker network ls
```

#### ä¾‹ï¼šwordpress ã‚µãƒ¼ãƒã¨ Mysql ã‚µãƒ¼ãƒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ãƒ»wordpress ã¨ mysql ã‚µãƒ¼ãƒã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

[mysql]

```
docker container run -d --name mysql \
--network wordpress-network \
-e MYSQL_ROOT_PASSWORD=wordpress \
-e MYSQL_DATABASE=wordpress \
-e MYSQL_USER=wordpress \
-e MYSQL_PASSWORD=wordpress \
mysql:8.0.25
```

[wordpress]

```
docker container run -d --name wordpress \
--network wordpress-network -p 8080:80 \
-e WORDPRESS_DB_HOST=mysql:3306 \
-e WORDPRESS_DB_NAME=wordpress \
-e WORDPRESS_DB_USER=wordpress \
-e WORDPRESS_DB_PASSWORD=wordpress \
wordpress:php7.4-apache
```

## 3-4 ã‚³ãƒ³ãƒ†ãƒŠã¨ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã®ä¸€æ‹¬å‰Šé™¤

ãƒ»ä¸è¦ãª docker ã‚³ãƒ³ãƒ†ãƒŠã‚’å…¨ã¦å‰Šé™¤

```
docker container prune
```

ãƒ»ä¸è¦ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å…¨ã¦å‰Šé™¤

```
docker image prune -a
```

# Chap04
